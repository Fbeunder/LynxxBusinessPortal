{% extends "base.html" %}

{% block title %}Lynxx Business Portal - Home{% endblock %}

{% block extra_head %}
{% if personalize %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
{% endif %}
{% endblock %}

{% block content %}
    {% if personalize %}
    <div class="personalization-info">
        <p>
            <i class="fas fa-info-circle"></i> 
            Tip: Je kunt apps als favoriet markeren door op de ster te klikken, en de volgorde aanpassen door te slepen.
        </p>
    </div>
    {% endif %}
    
    <div class="apps-grid" id="apps-container">
        {% for app in apps %}
            <div class="app-tile {% if app.is_favorite %}favorite{% endif %}" data-app-id="{{ loop.index0 }}">
                <a href="{{ app.url }}" target="_blank">
                    <div class="app-icon">
                        <span class="icon">
                            {% if app.icon == 'mail' %}ğŸ“§
                            {% elif app.icon == 'clock' %}â°
                            {% elif app.icon == 'book' %}ğŸ“š
                            {% elif app.icon == 'calendar' %}ğŸ“…
                            {% elif app.icon == 'chart' %}ğŸ“Š
                            {% elif app.icon == 'cloud' %}â˜ï¸
                            {% elif app.icon == 'code' %}ğŸ’»
                            {% elif app.icon == 'cog' %}âš™ï¸
                            {% elif app.icon == 'database' %}ğŸ—„ï¸
                            {% elif app.icon == 'desktop' %}ğŸ–¥ï¸
                            {% elif app.icon == 'download' %}â¬‡ï¸
                            {% elif app.icon == 'edit' %}âœï¸
                            {% elif app.icon == 'eye' %}ğŸ‘ï¸
                            {% elif app.icon == 'file' %}ğŸ“„
                            {% elif app.icon == 'folder' %}ğŸ“
                            {% elif app.icon == 'globe' %}ğŸŒ
                            {% elif app.icon == 'heart' %}â¤ï¸
                            {% elif app.icon == 'home' %}ğŸ 
                            {% elif app.icon == 'image' %}ğŸ–¼ï¸
                            {% elif app.icon == 'info' %}â„¹ï¸
                            {% elif app.icon == 'key' %}ğŸ”‘
                            {% elif app.icon == 'lock' %}ğŸ”’
                            {% elif app.icon == 'map' %}ğŸ—ºï¸
                            {% elif app.icon == 'message' %}ğŸ’¬
                            {% elif app.icon == 'mobile' %}ğŸ“±
                            {% elif app.icon == 'money' %}ğŸ’°
                            {% elif app.icon == 'pen' %}ğŸ–‹ï¸
                            {% elif app.icon == 'phone' %}ğŸ“
                            {% elif app.icon == 'print' %}ğŸ–¨ï¸
                            {% elif app.icon == 'search' %}ğŸ”
                            {% elif app.icon == 'server' %}ğŸ–§
                            {% elif app.icon == 'settings' %}âš™ï¸
                            {% elif app.icon == 'share' %}ğŸ“¤
                            {% elif app.icon == 'shield' %}ğŸ›¡ï¸
                            {% elif app.icon == 'shopping-cart' %}ğŸ›’
                            {% elif app.icon == 'star' %}â­
                            {% elif app.icon == 'tag' %}ğŸ·ï¸
                            {% elif app.icon == 'trash' %}ğŸ—‘ï¸
                            {% elif app.icon == 'upload' %}â¬†ï¸
                            {% elif app.icon == 'user' %}ğŸ‘¤
                            {% elif app.icon == 'users' %}ğŸ‘¥
                            {% elif app.icon == 'video' %}ğŸ¬
                            {% elif app.icon == 'wrench' %}ğŸ”§
                            {% else %}ğŸ”—
                            {% endif %}
                        </span>
                    </div>
                    <div class="app-info">
                        <h3>{{ app.name }}</h3>
                        <p>{{ app.description }}</p>
                    </div>
                </a>
                {% if personalize %}
                <div class="app-actions">
                    <button class="favorite-btn" data-app-id="{{ loop.index0 }}" title="Als favoriet markeren">
                        <i class="fas fa-star {% if app.is_favorite %}favorite-star{% endif %}"></i>
                    </button>
                    <div class="drag-handle" title="Verplaatsen">
                        <i class="fas fa-grip-lines"></i>
                    </div>
                </div>
                {% endif %}
            </div>
        {% endfor %}
    </div>
{% endblock %}

{% block extra_scripts %}
{% if personalize %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialiseer drag-and-drop functionaliteit
    const appsContainer = document.getElementById('apps-container');
    
    if (appsContainer) {
        const sortable = new Sortable(appsContainer, {
            animation: 150,
            handle: '.drag-handle',
            onEnd: function(evt) {
                // Verzamel nieuwe volgorde
                const appTiles = appsContainer.querySelectorAll('.app-tile');
                const newOrder = Array.from(appTiles).map(tile => parseInt(tile.dataset.appId));
                
                // Stuur nieuwe volgorde naar server
                fetch('/api/user/order', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ order: newOrder }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        console.log('Volgorde succesvol bijgewerkt');
                    } else {
                        console.error('Fout bij het bijwerken van de volgorde:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Fout bij het verzenden van de nieuwe volgorde:', error);
                });
            }
        });
    }
    
    // Favoriet toggle functionaliteit
    const favoriteBtns = document.querySelectorAll('.favorite-btn');
    
    favoriteBtns.forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            const appId = this.dataset.appId;
            const starIcon = this.querySelector('i');
            const appTile = document.querySelector(`.app-tile[data-app-id="${appId}"]`);
            
            fetch(`/api/user/favorites/${appId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    if (data.is_favorite) {
                        starIcon.classList.add('favorite-star');
                        appTile.classList.add('favorite');
                    } else {
                        starIcon.classList.remove('favorite-star');
                        appTile.classList.remove('favorite');
                    }
                } else {
                    console.error('Fout bij het bijwerken van favoriet:', data.message);
                }
            })
            .catch(error => {
                console.error('Fout bij het verzenden van favoriet:', error);
            });
        });
    });
});
</script>
{% endif %}
{% endblock %}
